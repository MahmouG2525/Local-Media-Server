<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <title>{{ name }} - Audio Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#6366f1">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Main CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
  </head>
  <body>
    <header class="player-navbar">
      <div
        class="container d-flex justify-content-between align-items-center gap-2"
      >
        <a href="{{ url_for('index') }}" class="btn-nav">
          <span>‚¨Ö</span>
          <span>Back to library</span>
        </a>

        <div
          class="d-none d-md-block text-truncate text-muted"
          style="max-width: 45vw; font-size: 0.85rem"
        >
          {{ name }}
        </div>

        <div class="d-flex align-items-center gap-2">
          <button
            id="theme-toggle"
            class="theme-toggle"
            type="button"
            aria-label="Toggle dark / light mode"
          >
            <span data-theme-icon>üåô</span>
            <span data-theme-label>Dark</span>
            <span class="theme-toggle-knob"></span>
          </button>

          <a
            href="{{ url_for('download_file', filename=relpath) }}"
            class="btn-nav"
          >
            <span>‚¨á</span>
            <span>Download</span>
          </a>
        </div>
      </div>
    </header>

    <main class="audio-player-shell" style="padding: 2rem 0; max-width: 800px; margin: 0 auto;">
      <div class="title-chip text-truncate" style="margin-bottom: 2rem;">
        <strong>Now playing:</strong> {{ name }}
      </div>

      <!-- Audio Player -->
      <div class="audio-player-container" style="
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 3rem 2rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      ">
        <!-- Album Art Placeholder -->
        <div style="
          width: 200px;
          height: 200px;
          margin: 0 auto 2rem;
          background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
          border-radius: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 4rem;
        ">
          üéµ
        </div>

        <!-- Track Info -->
        <div style="text-align: center; margin-bottom: 2rem;">
          <h3 style="margin-bottom: 0.5rem; font-weight: 600;">{{ name }}</h3>
          <p class="text-muted" style="font-size: 0.9rem;">Unknown Artist</p>
        </div>

        <!-- Audio Element -->
        <audio
          id="main-audio"
          controls
          preload="auto"
          style="width: 100%; border-radius: 12px; margin-bottom: 1rem;"
          src="{{ url_for('stream_file', filename=relpath) }}">
        </audio>

        <!-- Audio Info -->
        <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-muted);">
          <span id="current-time">0:00</span>
          <span id="duration">0:00</span>
        </div>
      </div>

      <!-- Keyboard Shortcuts Help -->
      <div class="mt-4 p-3" style="
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        font-size: 0.85rem;
      ">
        <strong>Keyboard Shortcuts:</strong> Space (play/pause), ‚Üê ‚Üí (seek), ‚Üë ‚Üì (volume), M (mute)
      </div>
    </main>

    <footer class="footer-meta text-center">
      Streaming from your local media server
    </footer>

    <!-- Theme JS -->
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <!-- Wake Lock -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <!-- Enhanced Audio Player with Media Session -->
    <script src="{{ url_for('static', filename='js/audio-player.js') }}"></script>

    <script>
      // Time display
      const audio = document.getElementById('main-audio');
      const currentTimeEl = document.getElementById('current-time');
      const durationEl = document.getElementById('duration');

      function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      audio.addEventListener('loadedmetadata', () => {
        durationEl.textContent = formatTime(audio.duration);
      });

      audio.addEventListener('timeupdate', () => {
        currentTimeEl.textContent = formatTime(audio.currentTime);
      });
    </script>
  </body>
</html>
